// Encrypted Medical Data Models
model EncryptedMedicalData {
  id           Int            @id @default(autoincrement())
  patientId    Int
  patient      PatientProfile @relation(fields: [patientId], references: [profileId])
  dataType     String         // "LAB_RESULT", "VITALS", "MEDICAL_HISTORY", etc.
  encryptedData String        // Homomorphically encrypted data
  publicKey    String         // Public key used for encryption
  cipherContext String        // Context parameters for aggregation
  metadata     Json?          // Additional metadata (unencrypted)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  @@index([patientId, dataType])
}

// Secure Multi-Party Computation
model MPCComputationSession {
  id           Int      @id @default(autoincrement())
  sessionType  String   // "AGGREGATION", "STATISTICAL_ANALYSIS"
  status      String   // "INITIATED", "COLLECTING", "COMPUTING", "COMPLETED"
  participants Int[]    // Array of participant IDs
  threshold   Int      // Minimum number of parties needed
  result      String?  // Final encrypted result
  startedAt   DateTime @default(now())
  completedAt DateTime?
  metadata    Json?    // Session configuration and parameters

  @@index([status])
}

// Partial Results for MPC
model MPCPartialResult {
  id          Int      @id @default(autoincrement())
  sessionId   Int      // Reference to MPCComputationSession
  partyId     Int      // ID of the contributing party
  partialData String   // Encrypted partial result
  submittedAt DateTime @default(now())
  verified    Boolean  @default(false)

  @@unique([sessionId, partyId])
}
